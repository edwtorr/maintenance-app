---
import MainLayout from '@/layouts/MainLayout.astro';
import Button from '@/components/Button';
import Select from '@/components/Select';
import { FailureStatusBadge, FailureSeverityBadge } from '@/components/Badge';
import { Download, FileText, Eye } from 'lucide-react';

const filterOptions = {
  lines: [
    { value: 'all', label: 'Todas las líneas' },
    { value: 'L16', label: 'L16' },
    { value: 'L20', label: 'L20' },
    { value: 'L33', label: 'L33' },
  ],
  status: [
    { value: 'all', label: 'Todos los estados' },
    { value: 'open', label: 'Abiertas' },
    { value: 'in_progress', label: 'En Progreso' },
    { value: 'resolved', label: 'Resueltas' },
    { value: 'closed', label: 'Cerradas' },
  ],
  severity: [
    { value: 'all', label: 'Todas las urgencias' },
    { value: 'critical', label: 'Crítica' },
    { value: 'high', label: 'Alta' },
    { value: 'medium', label: 'Media' },
    { value: 'low', label: 'Baja' },
  ],
  period: [
    { value: 'today', label: 'Hoy' },
    { value: 'week', label: 'Última semana' },
    { value: 'month', label: 'Último mes' },
    { value: 'quarter', label: 'Último trimestre' },
    { value: 'year', label: 'Último año' },
    { value: 'custom', label: 'Personalizado' },
  ],
};

const historyRecords = [
  {
    id: 1,
    title: 'Fallo en motor principal',
    machine: 'Máquina XZ-100',
    line: 'L16',
    status: 'closed',
    severity: 'critical',
    reportedDate: '2024-11-05 14:30',
    resolvedDate: '2024-11-05 18:45',
    duration: '4h 15min',
    technician: 'Juan Pérez',
    solution: 'Reemplazo de rodamientos',
  },
  {
    id: 2,
    title: 'Sensor de temperatura desajustado',
    machine: 'Máquina AB-250',
    line: 'L20',
    status: 'closed',
    severity: 'medium',
    reportedDate: '2024-11-04 09:15',
    resolvedDate: '2024-11-04 11:30',
    duration: '2h 15min',
    technician: 'María García',
    solution: 'Recalibración de sensores',
  },
  {
    id: 3,
    title: 'Fuga hidráulica mayor',
    machine: 'Máquina CD-320',
    line: 'L33',
    status: 'closed',
    severity: 'high',
    reportedDate: '2024-11-03 15:20',
    resolvedDate: '2024-11-04 10:00',
    duration: '18h 40min',
    technician: 'Carlos López',
    solution: 'Reemplazo de mangueras y sellos',
  },
];
---

<MainLayout title="Histórico de Averías - Gestión de Averías" currentPath="/history">
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-dark-900 dark:text-dark-50 mb-2">
      Histórico de Averías
    </h1>
    <p class="text-dark-600 dark:text-dark-400">
      Consulta y analiza el historial completo de averías
    </p>
  </div>

  <!-- Advanced Filters -->
  <div class="card p-6 mb-6">
    <h2 class="text-lg font-semibold text-dark-900 dark:text-dark-50 mb-4">
      Filtros Avanzados
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
      <Select
        label="Línea de Producción"
        options={filterOptions.lines}
        client:load
      />
      <Select
        label="Estado"
        options={filterOptions.status}
        client:load
      />
      <Select
        label="Urgencia"
        options={filterOptions.severity}
        client:load
      />
      <Select
        label="Período"
        options={filterOptions.period}
        client:load
      />
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-dark-900 dark:text-dark-50 mb-1.5">
          Fecha Desde
        </label>
        <input
          type="date"
          class="w-full px-4 py-2 rounded-lg bg-white dark:bg-dark-900 border border-light-300 dark:border-dark-700 text-dark-900 dark:text-dark-50 focus:outline-none focus:ring-2 focus:ring-primary-500"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-dark-900 dark:text-dark-50 mb-1.5">
          Fecha Hasta
        </label>
        <input
          type="date"
          class="w-full px-4 py-2 rounded-lg bg-white dark:bg-dark-900 border border-light-300 dark:border-dark-700 text-dark-900 dark:text-dark-50 focus:outline-none focus:ring-2 focus:ring-primary-500"
        />
      </div>
      <div>
        <label class="block text-sm font-medium text-dark-900 dark:text-dark-50 mb-1.5">
          Búsqueda
        </label>
        <input
          type="search"
          placeholder="Buscar por título, máquina..."
          class="w-full px-4 py-2 rounded-lg bg-white dark:bg-dark-900 border border-light-300 dark:border-dark-700 text-dark-900 dark:text-dark-50 focus:outline-none focus:ring-2 focus:ring-primary-500"
        />
      </div>
    </div>

    <div class="flex gap-3">
      <Button variant="primary" client:load>
        Aplicar Filtros
      </Button>
      <Button variant="outline" client:load>
        Limpiar
      </Button>
      <div class="ml-auto flex gap-2">
        <Button variant="outline" icon={<Download class="w-4 h-4" />} client:load>
          Excel
        </Button>
        <Button variant="outline" icon={<FileText class="w-4 h-4" />} client:load>
          PDF
        </Button>
      </div>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="mb-4">
    <p class="text-sm text-dark-600 dark:text-dark-400">
      Se encontraron <span class="font-semibold text-dark-900 dark:text-dark-50">{historyRecords.length}</span> registros
    </p>
  </div>

  <!-- History Table -->
  <div class="card overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-light-100 dark:bg-dark-800">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              ID
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              Avería
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              Ubicación
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              Urgencia
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              Reportada
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              Resuelta
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              Duración
            </th>
            <th class="px-6 py-3 text-left text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              Técnico
            </th>
            <th class="px-6 py-3 text-right text-xs font-medium text-dark-700 dark:text-dark-300 uppercase tracking-wider">
              Acciones
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-light-300 dark:divide-dark-800">
          {historyRecords.map((record) => (
            <tr class="hover:bg-light-100 dark:hover:bg-dark-800 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-dark-900 dark:text-dark-50">
                #{record.id}
              </td>
              <td class="px-6 py-4 text-sm">
                <div class="font-medium text-dark-900 dark:text-dark-50">{record.title}</div>
                <div class="text-xs text-dark-600 dark:text-dark-400 mt-1">{record.solution}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-600 dark:text-dark-400">
                <div>{record.machine}</div>
                <div class="text-xs text-dark-500 dark:text-dark-500">{record.line}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <FailureSeverityBadge severity={record.severity} client:load />
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-600 dark:text-dark-400">
                {record.reportedDate}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-600 dark:text-dark-400">
                {record.resolvedDate}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-primary-600 dark:text-primary-400">
                {record.duration}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-dark-600 dark:text-dark-400">
                {record.technician}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                <Button variant="ghost" size="sm" icon={<Eye class="w-4 h-4" />} client:load>
                  Ver
                </Button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="px-6 py-4 border-t border-light-300 dark:border-dark-800 flex items-center justify-between">
      <p class="text-sm text-dark-600 dark:text-dark-400">
        Mostrando <span class="font-medium">1-{historyRecords.length}</span> de <span class="font-medium">{historyRecords.length}</span> resultados
      </p>
      <div class="flex gap-2">
        <Button variant="outline" size="sm" disabled client:load>
          Anterior
        </Button>
        <Button variant="outline" size="sm" disabled client:load>
          Siguiente
        </Button>
      </div>
    </div>
  </div>
</MainLayout>
